import os
from dotenv import load_dotenv

load_dotenv()

BASE_DIR = os.path.dirname(os.path.abspath(__file__))

DEVICE = os.getenv("DEVICE", "cpu")

# Table confidence threshold
TABLE_CONF_THRES = float(os.getenv("CONF_THRES", 0.7))

# Card confidence threshold
CARD_CONF_THRES = 0.6

MODEL_TABLE_PATH = os.path.join(
    BASE_DIR,
    os.getenv("MODEL_TABLE_PATH", "vision/models/table_detector_v1.pt")
)

# Screen Capture Vars
CAPTURE_FPS = int(os.getenv("CAPTURE_FPS", 30))
CAPTURE_REGION = None
WINDOW_NAME = "PokerBot Debug (q to quit)"

# Player Detection Vars
EDGE_RATIO_THRESHOLD = 0.1
LAPLACIAN_VAR_THRESHOLD = 100.0
NMS_OVERLAP_THRESHOLD = 0.45



TABLE_ROIS = {
    "player_card_1": (0.43972, 0.74722, 0.02955, 0.0779),
    "player_card_2": (0.48818, 0.74722, 0.03073, 0.0779),
    "community_card_1": (0.30851, 0.42448, 0.02955, 0.07631),
    "community_card_2": (0.38652, 0.42448, 0.02955, 0.07631),
    "community_card_3": (0.46336, 0.42448, 0.02955, 0.07631),
    "community_card_4": (0.54137, 0.42448, 0.02955, 0.07631),
    "community_card_5": (0.61820, 0.42448, 0.02955, 0.07631),
    "pot_area": (0.45981, 0.60254, 0.08038, 0.03180),
}

SEAT_ROIS = {
    "seat_0": {
        "occupancy": (0.44693, 0.11058, 0.10259, 0.12954),
        "name": (0.44575, 0.21000, 0.11085, 0.03476),
        "VPIP": (0.43868, 0.18000, 0.02948, 0.03002),
        "stack": (0.44575, 0.25000, 0.10967, 0.03160),
        "bet": (0.46226, 0.32000, 0.07547, 0.03318),
        "pos": (0.40094, 0.28000, 0.03420, 0.04107),
    },
    "seat_1": {
        "occupancy": (0.80307, 0.21643, 0.10024, 0.13112),
        "name": (0.79127, 0.31754, 0.11321, 0.03160),
        "VPIP": (0.78892, 0.28436, 0.02712, 0.03002),
        "stack": (0.79127, 0.34913, 0.11321, 0.03318),
        "bet": (0.73821, 0.42180, 0.08137, 0.03791),
        "pos": (0.73231, 0.30490, 0.03302, 0.03949),        
    },
    "seat_2": {
        "occupancy": (0.08962, 0.21643, 0.10259, 0.14112),
        "name": (0.09000, 0.32438, 0.11203, 0.03576),
        "VPIP": (0.09000, 0.29500, 0.02712, 0.02786),
        "stack": (0.09000, 0.35513, 0.11085, 0.03418),
        "bet": (0.17000, 0.43000, 0.07783, 0.03260),
        "pos": (0.23000, 0.31000, 0.03538, 0.04207),
    },
    "seat_3": {
        "occupancy": (0.86321, 0.43602, 0.10024, 0.12638),
        "name": (0.85613, 0.54555, 0.11557, 0.03418),
        "VPIP": (0.85495, 0.51395, 0.02830, 0.03200),
        "stack": (0.85259, 0.58030, 0.11675, 0.03506),
        "bet": (0.75236, 0.54944, 0.09080, 0.02904),
        "pos": (0.81250, 0.60000, 0.03892, 0.04207),
    },
    "seat_4": {
        "occupancy": (0.02830, 0.43760, 0.10377, 0.12796),
        "name": (0.02476, 0.54555, 0.11557, 0.04160),
        "VPIP": (0.02358, 0.51237, 0.03066, 0.04002),
        "stack": (0.02358, 0.57872, 0.11792, 0.04633),
        "bet": (0.15684, 0.55344, 0.07901, 0.03844),
        "pos": (0.14505, 0.60242, 0.03420, 0.04633),
    },
    "seat_5": {
        "occupancy": (0.79599, 0.65087, 0.10967, 0.13270),
        "name": (0.78774, 0.76197, 0.11910, 0.02786),
        "VPIP": (0.78420, 0.72022, 0.03184, 0.03260),
        "stack": (0.78892, 0.79041, 0.11557, 0.03506),
        "bet": (0.71698, 0.62295, 0.08491, 0.03200),
        "pos": (0.74410, 0.67035, 0.03302, 0.03703),
    },
    "seat_6": {
        "occupancy": (0.09906, 0.65087, 0.10259, 0.12796),
        "name": (0.09871, 0.76145, 0.10928, 0.03476),
        "VPIP": (0.09048, 0.72986, 0.03055, 0.03002),
        "stack": (0.09871, 0.79779, 0.10693, 0.03160),
        "bet": (0.19741, 0.62559, 0.08813, 0.03318),
        "pos": (0.21504, 0.66509, 0.04700, 0.04423),
    },
    "seat_7": {
        "occupancy": (0.57547, 0.10427, 0.10731, 0.13270),
        "name": (0.57344, 0.21643, 0.11633, 0.03633),
        "VPIP": (0.56639, 0.18167, 0.03643, 0.03318),
        "stack": (0.57344, 0.24803, 0.11281, 0.03633),
        "bet": (0.58284, 0.32701, 0.08578, 0.02686),
        "pos": (0.69213, 0.30174, 0.03878, 0.04265),
    },
    "seat_8": {
        "occupancy": (0.31722, 0.10742, 0.10613, 0.13112),
        "name": (0.31140, 0.21643, 0.11986, 0.03160),
        "VPIP": (0.30435, 0.18325, 0.03878, 0.03002),
        "stack": (0.30905, 0.24803, 0.11986, 0.03949),
        "bet": (0.33490, 0.32859, 0.07991, 0.02844),
        "pos": (0.26675, 0.30174, 0.04583, 0.04423),
    },
    "seat_9": {
        "occupancy": (0.84316, 0.28120, 0.10377, 0.13902),
        "name": (0.83549, 0.39336, 0.12103, 0.03476),
        "VPIP": (0.82961, 0.36019, 0.03878, 0.03791),
        "stack": (0.83549, 0.42970, 0.11986, 0.03476),
        "bet": (0.75676, 0.51343, 0.08343, 0.02844),
        "pos": (0.84019, 0.53081, 0.04348, 0.04107),
    },
    "seat_10": {
        "occupancy": (0.04835, 0.28752, 0.10495, 0.12638),
        "name": (0.04583, 0.39652, 0.11633, 0.03002),
        "VPIP": (0.04348, 0.36177, 0.03173, 0.03949),
        "stack": (0.04583, 0.42654, 0.11868, 0.03949),
        "bet": (0.15511, 0.51027, 0.09871, 0.03318),
        "pos": (0.11633, 0.52291, 0.04583, 0.05371),
    },
    "seat_11": {
        "occupancy": (0.75000, 0.67615, 0.09906, 0.12954),
        "name": (0.74383, 0.78199, 0.11633, 0.03949),
        "VPIP": (0.73561, 0.75197, 0.03995, 0.03318),
        "stack": (0.74148, 0.81991, 0.11986, 0.03791),
        "bet": (0.66863, 0.64929, 0.09636, 0.03160),
        "pos": (0.68155, 0.67773, 0.04818, 0.03949),
    },
    "seat_12": {
        "occupancy": (0.14505, 0.66667, 0.10259, 0.14060),
        "name": (0.13866, 0.78041, 0.12456, 0.03791),
        "VPIP": (0.13278, 0.74566, 0.03995, 0.04265),
        "stack": (0.13749, 0.81201, 0.12573, 0.04423),
        "bet": (0.24089, 0.64929, 0.09283, 0.03002),
        "pos": (0.27145, 0.67773, 0.04583, 0.03949),
    },
    "seat_13": {
        "occupancy": (0.77358, 0.18641, 0.10259, 0.13112),
        "name": (0.76651, 0.29120, 0.11675, 0.03576),
        "VPIP": (0.76061, 0.25061, 0.03420, 0.03408),
        "stack": (0.76651, 0.32096, 0.11321, 0.03506),
        "bet": (0.70401, 0.40079, 0.09080, 0.03200),
        "pos": (0.81250, 0.39005, 0.03774, 0.04207),
    },
    "seat_14": {
        "occupancy": (0.11675, 0.18167, 0.10613, 0.13586),
        "name": (0.11675, 0.29008, 0.11439, 0.03576),
        "VPIP": (0.11203, 0.24905, 0.03184, 0.03418),
        "stack": (0.11675, 0.32554, 0.11203, 0.03418),
        "bet": (0.20401, 0.39979, 0.08726, 0.02944),
        "pos": (0.14623, 0.39063, 0.03774, 0.03733),
    },
    "seat_15": {
        "occupancy": (0.55071, 0.10585, 0.10024, 0.12954),
        "name": (0.54245, 0.21037, 0.11557, 0.03260),
        "VPIP": (0.53538, 0.17562, 0.03538, 0.03418),
        "stack": (0.54245, 0.24255, 0.11321, 0.03891),
        "bet": (0.55307, 0.32096, 0.08962, 0.02944),
        "pos": (0.66038, 0.27330, 0.03774, 0.03891),
    },
    "seat_16": {
        "occupancy": (0.34670, 0.10585, 0.09906, 0.12796),
        "name": (0.33844, 0.20063, 0.11910, 0.04049),
        "VPIP": (0.33373, 0.17220, 0.03420, 0.03418),
        "stack": (0.34552, 0.24013, 0.10849, 0.03891),
        "bet": (0.36085, 0.31596, 0.07901, 0.03102),
        "pos": (0.29717, 0.27488, 0.04009, 0.03733),
    }
}

SEAT_EXCLUSION_GROUPS = [
    ["seat_7", "seat_15"],
    ["seat_8", "seat_16"],
    ["seat_5", "seat_11"],
    ["seat_6", "seat_12"],
    ["seat_1", "seat_9", "seat_13"],
    ["seat_2", "seat_10", "seat_14"],
]



 
